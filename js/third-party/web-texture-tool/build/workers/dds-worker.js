importScripts("./worker-util.js");const t=542327876,u=131072,v=4;function r(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function w(e){return String.fromCharCode(e&255,e>>8&255,e>>16&255,e>>24&255)}const x=r("DXT1"),y=r("DXT3"),z=r("DXT5"),A=r("ETC1"),B=31,C=0,D=1,E=2,F=3,G=4,H=7,I=20,J=21,K=22,L=23,M=24,N=25,O=26;function P(e,s,i,f){const c=new Uint16Array(4),d=new Uint16Array(i*f),n=i*f/4;let a=0,b=0,g=0,j=0,o=0,p=0,h=0;const k=i/4,l=f/4;for(let m=0;m<l;m++)for(let q=0;q<k;q++)g=s+4*(m*k+q),c[0]=e[g],c[1]=e[g+1],j=c[0]&63519,o=c[0]&2016,p=c[1]&63519,h=c[1]&2016,c[2]=5*j+3*p>>3&63519|5*o+3*h>>3&2016,c[3]=5*p+3*j>>3&63519|5*h+3*o>>3&2016,a=e[g+2],b=m*4*i+q*4,d[b]=c[a&3],d[b+1]=c[a>>2&3],d[b+2]=c[a>>4&3],d[b+3]=c[a>>6&3],b+=i,d[b]=c[a>>8&3],d[b+1]=c[a>>10&3],d[b+2]=c[a>>12&3],d[b+3]=c[a>>14],a=e[g+3],b+=i,d[b]=c[a&3],d[b+1]=c[a>>2&3],d[b+2]=c[a>>4&3],d[b+3]=c[a>>6&3],b+=i,d[b]=c[a>>8&3],d[b+1]=c[a>>10&3],d[b+2]=c[a>>12&3],d[b+3]=c[a>>14];return d}function Q(e,s,i){const f=new Int32Array(e,0,B);if(f[C]!=t)throw new Error("Invalid magic number in DDS header");if(!f[I]&v)throw new Error("Unsupported format, must contain a FourCC code");const c=f[J];let d=0,n=0,a="unknown";switch(c){case x:d=8,a="bc1-rgb-unorm";break;case y:d=16,a="bc2-rgba-unorm";break;case z:d=16,a="bc3-rgba-unorm";break;case A:d=8,a="etc1-rgb-unorm";break;default:{const h=f[K],k=f[L],l=f[M],m=f[N],q=f[O];h===32?k&255&&l&65280&&m&16711680?(a="rgba8unorm",n=4):k&16711680&&l&65280&&m&255&&(a="bgra8unorm",n=4):h===24&&(k&16711680&&l&65280&&m&255&&(a="rgb8unorm",n=3))}}let b=f[G],g=f[F],j=f[D]+4;if(s.indexOf(a)==-1)if(a==="bc1-rgb-unorm"&&s.indexOf("rgb565unorm")!=-1)a="rgb565unorm",n=2,e=P(new Uint16Array(e),j/2,b,g).buffer,j=0;else throw new Error(`Unsupported
       texture format: ${w(c)} ${a}`);if(d==0)return new WorkerTextureData({format:a,width:b,height:g,imageData:e,imageDataOptions:{byteOffset:j,byteLength:b*g*n}});let o=1;f[E]&u&&i!==!1&&(o=Math.max(1,f[H]));const p=new WorkerTextureData({format:a,width:b,height:g});for(let h=0;h<o;++h){const k=p.getLevel(h),l=d?Math.max(4,b)/4*Math.max(4,g)/4*d:b*g*4;k.setSlice(0,e,{byteOffset:j,byteLength:l}),j+=l,b=Math.max(1,Math.ceil(b/2)),g=Math.max(1,Math.ceil(g/2))}return p}onmessage=createTextureMessageHandler(Q);
//# sourceMappingURL=dds-worker.js.map
